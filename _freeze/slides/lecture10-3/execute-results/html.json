{
  "hash": "757bdfa92e28da59eec2e188f3986562",
  "result": {
    "markdown": "---\ntitle: \"Linear Programming Under Uncertainty\"\nsubtitle: \"Lecture 21\"\nauthor: \"Vivek Srikrishnan\"\ncourse: \"BEE 4750\"\ninstitution: \"Cornell University\"\ndate: \"October 25, 2023\"\nformat:\n    revealjs:\n        slide-number: c/t\n        show-slide-number: all\n        center-title-slide: true\n        width: 1280\n        height: 720\n        transition: none\n        toc: true\n        toc-depth: 1\n        toc-title: \"Overview\"\n        history: false\n        link-external-newwindow: true\n        theme: ../sass/slides.scss\n        footer: \"[BEE 4750, Environmental Systems Analysis](https://viveks.me/environmental-systems-analysis)\"\n        template-partials:\n            - title-slide.html\n        menu:\n            numbers: true\n        html-math-method: mathjax\n        include-in-header: mathjax-config.html\n        date-format: long\n\nexecute:\n    freeze: auto\n---\n\n\n\n\n\n# Review and Questions\n\n## Solid Waste Management\n\n- Different types of facilities with different **residual** wastes, which impacts the broader system.\n- Model as a **network**,   where we care about the flows between different nodes.\n- Becomes a mixed integer program if we can choose not to operate facilities.\n\n## Questions\n\n:::: {.columns .center}\n::: {.column width=\"40%\"}\n![](images/vsrikrish-poll.png){fig-alt=\"Poll Everywhere QR Code\" fig-align=\"center\" width=\"100%\"}\n:::\n::: {.column width=60%}\n**Text**: VSRIKRISH to 22333\n\n**URL**: [https://pollev.com/vsrikrish](https://pollev.com/vsrikrish)\n<br><br>\n[See Results](https://www.polleverywhere.com/multiple_choice_polls/qKeig0hHShZYHAOmvZtZm?preview=true&controls=none){preview-link=\"true\"}\n:::\n::::\n\n\n\n# Decision-Making Under Uncertainty\n\n## Certainty and LP\n\n**Certainty** (*e.g.* all parameters and relationships between decision variables and outcomes are known) is a key assumption of linear programming.\n\nBut most systems problems aren't actually deterministic.\n\n## Approaches to Decision-Making Under Uncertainty\n\n**A Common Approach**:\n\n1. Solve deterministic problem using best estimates.\n2. Stress-test solution with Monte Carlo or include additional safety margins (more on this later).\n\n## Representing Uncertainty in Mathematical Programs\n\n**Alternative**: \n\n1. Solve a *stochastic* problem for best expected performance (or similar summary statistic).\n\n::: {.fragment .fade-in}\nWe can represent uncertainty through scenarios and (conditional) sequential events, then rewrite the decision problem.\n:::\n\n# Example: Land Allocation \n\n## Land Allocation/Farmer Problem\n\nA farmer can grow wheat, corn, and sugar beets on 500 ha of land. How much land should they allocate to each crop?\n\n## Key information For Problem\n\n- Planting costs are \\$150, \\$230, and \\$260 per acre for wheat, corn, and sugar beets, respectively.\n- The farmer requires 200T of wheat and 240T kg of corn for feed, and excess can be sold for \\$170 and \\$150 per T, respectively.\n- Purchasing crops costs \\$40 more than the selling prices.\n- Sugar beets are sold at \\$36/T up to 6000T, at which point the price drops to \\$10 per T.\n\n## Farm Yields\n\nFrom prior experience, the farmer knows that in an average year, yields are:\n\n- 2.5 T/acre for wheat;\n- 3 T/acre per corn;  \n- 20T/acre for beets.\n\n## Decision Variables \n\n***What are the decision variables?***\n\n::: {.fragment .fade-in}\nVariable | Definition\n:----: | :-----\n$x_i$ | acres of crop $i$ planted\n$y_i$ | T of crop $i$ purchased\n$z_i$ | T of crop $i$ sold\n:::\n\nOne twist: sold beets will be represented by two different $z$-variables ($z_3$ and $z_4$), based on whether we exceed 6000T.\n\n## Deterministic Problem Formulation\n\n$$\n\\begin{align}\n\\min_{x, y, z} & \\quad 150x_1 + 230 x_2 + 260 x_3 + 238 y_1 + 210 y_2 - 170 z_1 \\\\\n& \\qquad -150z_2 - 36z_3 - 10z_4 \\\\[1ex]\n\\text{subject to:} \\quad & x_1 + x_2 + x_3 \\leq 500 \\\\[0.5ex]\n& 2.5 x_1 + y_1 - z_1 \\geq 200 \\\\[0.5ex]\n& 3 x_2 + y_2 - z_2 \\geq 240 \\\\[0.5ex]\n& z_3 + z_4 \\leq 20 x_3 \\\\[0.5ex]\n& z_3 \\leq 6000 \\\\[0.5ex]\n& x_i, y_i, z_i \\geq 0\n\\end{align}\n$$\n\n## Deterministic Solution\n\n\nVariable | Wheat | Corn | Beets\n:----- | :-----: | :----: | :-----:\nArea (acres) | 120 | 80 | 300\nYield (T) | 300 | 240 | 6000 \nSales (T) | 100 | -- | 6000 \nPurchased (T) | -- | -- | --\n\nThis solution yields a profit of \\$118,600.\n\n## What About Uncertainty?\n\nBut yields tend to vary from year to year. From prior experience, the historical variability is:\n\n- in a good year, yields can be 20% above average;\n- in a bad year, yields can be 20% below average.\n\n::: {.fragment .fade-in}\nTo simplify things, let's assume these yields vary consistently across crops and that each scenario (average, good, bad) has an equal probability of occurrence.\n:::\n\n## Stochastic Decision Variables\n\n***What should change about our decision variables?***\n\n::: {.fragment .fade-in}\nVariable | Definition\n:----: | :-----\n$x_i$ | acres of crop $i$ planted\n$y_{ij}$ | T of crop $i$ purchased in scenario $j$\n$z_{ij}$ | T of crop $i$ sold in scenario $j$\n\n:::\n\n\n## Two-Stage Problems\n\nThis is typical of a **two-stage** decision problem:\n\n1. Make an **initial** decision (*e.g.* how much to plant) which must be committed to ahead of knowing the stochastic realization;\n2. Make a subsequent **recourse** decision based on the realization (*e.g.* do we have to purchase additional crops?)\n\n## Stochastic Objective\n\n***How can we formulate an objective?***\n\n::: {.fragment .fade-in}\n**First choice: what statistic are we trying to optimize?**\n\n::: {.fragment .fade-in}\nLet's choose the expected value $\\mathbb{E}\\left[\\text{Profit}\\right]$.\n\nOther possible choices: quantiles (*robust optimization*) to hedge against worst-case outcomes, variance (to minimize year-on-year fluctuations).\n:::\n:::\n\n\n## Probabilities and Scenario Trees\n\n:::: {.columns}\n::: {.column width=55%}\nSince we have a discrete (and small) set of possible outcomes, we can use a **scenario tree** to write out the possible outcomes.\n:::\n::: {.column width=45%}\n![Scenario Tree for Farmer Problem](figures/farm-scen-tree.svg)\n:::\n::::\n\n## Stochastic Objective\n\nOur new objective becomes:\n\n$$\\begin{alignedat}{2}\n&\\min_{x, y, z} & & \\quad 150x_1 + 230x_2 + 260x_3 \\\\[0.5ex]\n& &&\\qquad -\\frac{1}{3} \\left(170z_{11} + 150z_{21} + 36z_{31} + 10z_{41} - 238y_{11} - 210 y_{21}\\right) \\\\[0.5ex]\n& &&\\qquad -\\frac{1}{3} \\left(170z_{12} + 150z_{22} + 36z_{32} + 10z_{42} - 238y_{12} - 210 y_{22}\\right) \\\\[0.5ex]\n& &&\\qquad -\\frac{1}{3} \\left(170z_{13} + 150z_{23} + 36z_{33} + 10z_{43} - 238y_{13} - 210 y_{23}\\right)\n\\end{alignedat}$$\n\n## Stochastic Contraints\n\n$$\\begin{alignedat}{2}\n&x_1 + x_2 + x_3 \\leq 500 \\\\[0.5ex]\n&\\color{blue}3x_1 + y_{11} - z_{11} \\geq 200, && \\qquad  \\color{blue}3.6x_2 + y_{21} - z_{21} \\geq 240 \\\\[0.5ex]\n&\\color{blue}z_{31} + z_{41} \\leq 24x_3, && \\qquad \\color{blue}z_{31} \\leq 6000 \\\\[0.5ex]\n&\\color{purple}2.5x_1 + y_{12} - z_{12} \\geq 200, && \\qquad \\color{purple}3x_2 + y_{22} - z_{22} \\geq 240 \\\\[0.5ex]\n&\\color{purple}z_{32} + z_{42} \\leq 20x_3, && \\qquad \\color{purple}z_{32} \\leq 6000 \\\\[0.5ex]\n&\\color{red}2x_1 + y_{13} - z_{13} \\geq 200, && \\qquad \\color{red}2.4x_2 + y_{23} - z_{23} \\geq 240 \\\\[0.5ex]\n&\\color{red}z_{33} + z_{43} \\leq 16x_3, && \\qquad \\color{red}z_{33} \\leq 6000 \\\\[0.5ex]\n&x_i, y_i, z_i \\geq 0\n\\end{alignedat}$$\n\n\n## Stochastic Solution\n\nVariable | Wheat | Corn | Beets\n:----- | :-----: | :----: | :-----:\nDeterministic Area (acres) | 120 | 80 | 300\nStochastic Area (acres) | 170 | 80 | 250 \n\nHow do we interpret the differences?\n\n::: {.fragment .fade-in}\n- **Good year**: Won't waste acreage on extra beets (6000T yield in stochastic solution, 7200T for deterministic)\n- **Bad year**: Will make less off beets, profits from wheat should help cover extra corn purchase.\n:::\n\n# Value of the Stochastic Solution\n\n## Comparing Deterministic and Stochastic Solution\n\n- **Deterministic Solution**: \"Expected\" Profit (no uncertainty) = \\$118,600\n- **Stochastic Solution**: $\\mathbb{E}[\\text{Profit}]$ = \\$108,390.\n\n::: {.fragment .fade-in}\n***Can we directly compare the deterministic and stochastic solution values that we have obtained so far?***\n:::\n\n## Expected Performance of Deterministic Solution\n\nYear | Deterministic Profit | Stochastic Profit\n:--- | :----: | :----:\nGood | \\$148,000 | \\$167,000\nAverage | \\$118,600 | \\$109,350\nBad | \\$56,800 | \\$48,820\n\n**Expected Profit from Deterministic Solution *under uncertainty***: \\$107,240\n\n## Value of the Stochastic Solution\n\nWe can now compare the difference in expected profits *under uncertainty*, which is the fair comparison. \n\nThis is called the **value of the stochastic solution (VSS)**, or sometimes the **expected value of including uncertainty (EVIU)**.\n\n$$\\begin{aligned}\nVSS &= \\mathbb{E}[\\text{Stochastic Profit}] - \\mathbb{E}[\\text{Deterministic Profit}] \\\\[0.5ex]\n&= \\$108,390 - \\$107,240 \\\\[0.5ex]\n&= \\$1,150.\n\\end{aligned}$$\n\n## Expected Value of Perfect Information\n\nAnother relevant quantity, the **expected value of perfect information (EVPI)**, concerns the value associated with better forecasts.\n\n## Expected Value of Perfect Information\n\nIf the farmer had perfect foresight and could allocate acreage $x$ accordingly and sell/purchase $z$ and $y$ optimally (versus taking the 1/3-probability stochastic solution),\n\n$$\\mathbb{E}[\\text{Profits} | \\text{perfect information}] = \\sum_j p_j \\times \\text{Profits}_j = \\$115,405.$$\n\n::: {.fragment .fade-in}\n$$\\text{EVPI} = \\$115,405 - \\$108,390 = \\$7,015$$\n\nThe EVPI can be interpreted as the amount *the farmer might be willing to pay* for an improved forecast.\n:::\n\n# Key Takeaways\n\n## Decision-Making and Uncertainty\n\n- A solution obtained assuming deterministic outcomes might \"on paper\" yield better anticipated outcomes.\n- Common approach is a two-stage optimization framework:\n    - Make an initial decision;\n    - Recourse based on which scenario is realized.\n- Scenario trees help build out the representation of outcomes and probabilities.\n\n## Value of the Stochastic Solution\n\n\n- Solutions to stochastic problems can produce a better expected outcome than the deterministic solution, but will perform better/worse in any given scenario.\n- Value of the stochastic solution quantifies expected improvement in performance.\n- Expected value of perfect information: amount you might be willing to pay for improved forecasts.\n\n",
    "supporting": [
      "lecture10-3_files"
    ],
    "filters": [],
    "includes": {}
  }
}